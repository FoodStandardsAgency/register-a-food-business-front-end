# The repository structure

## Root directory files

* `README.md`

  A broad overview of the purpose of this repository

* `LICENSE`

  The license for this repository

* `CONTRIBUTING.md`

  The starting point for contributing to this repository

* `CHANGELOG.md`

  Every change to the repository that affects users should be given a version number and logged in this file. For more information about versioning, see https://semver.org/.

* `package.json`

  The starting point for understanding how to use this repository and what dependencies it has. For more information about NPM and Node, see https://docs.npmjs.com/. For more information about the `package.json` file, see: https://docs.npmjs.com/files/package.json.

* `yarn.lock`

  Use the `yarn` CLI with this repository to install, add, and remove dependencies. The `yarn.lock` file is used and updated automatically. For more information about `yarn`, see https://yarnpkg.com/en/.

* `.gitignore`

  A number of files and directories are ignored by `git` either to reduce conflicts and repository size on GitHub, or for security reasons. For more information about this file, see https://help.github.com/articles/ignoring-files/.

* `.env` (not committed)

  Create a `.env` file in the root directory to store environment variables. The `.env` file is included in the `.gitignore` file for security purposes because many environment variables are passwords, which should not be made public in an open-source repository.

* `next.config.js`

  The configuration for the Next.js framework. For more information about Next.js, see https://nextjs.org/docs.

* `jest.config.js`

  Jest is the main testing library used for this project. The Jest config file references `jest.setup.js`, configures test reporters, defines code coverage rules, and sets up global mocks. For more information about the Jest config file, see https://jestjs.io/docs/en/configuration.html.

* `jest.setup.js`

  The setup file connects Jest to Enzyme, a supplementary library that makes it easier to test React-based front-end components.

* `polyfills.js`

  Comprehensive JavaScript polyfills from Babel are used as part of the build process to provide missing JavaScript functionality for older browsers such as Internet Explorer.

* `.eslintrc`

  ESLint is a tool that checks code for simple bad practices and cleanliness, such as unused variables. This file defines the ESLint rules and extensions. For more information about the `.eslintrc` file, see https://eslint.org/docs/user-guide/configuring.

* `.babelrc`

  Babel is a tool that converts the latest EcmaScript syntax into an older format, which can be read by a wider range of tools and browsers, such as Next.js and Jest. This file defines the Babel rules and extensions. For more information about the `.babelrc` file, see https://babeljs.io/docs/en/config-files.

* `azure-pipelines.yml`

  Azure devOps runs pipelines that build, test and release the code in this repository. This file defines the steps for the build pipelines in Azure devOps. For more information about configuring Azure build pipelines, see https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema.

* `deploy.sh`

  This file overrides the default Azure deployment step during a release pipeline. Auto-generated by Azure and modified to match the project requirements.

* `.deployment`

  This file is read by Azure at the deployment step during a release pipeline and points to `deploy.sh`.

* `.snyk`

  Snyk is a tool that scans the repository for security vulnerabilities. This file defines the configuration of Snyk when it is run from the `package.json` script.

* `.prettierignore`

  Prettier is a tool that checks and corrects the formatting of code, such as line indentations and semicolons. This file defines the files that are ignored by Prettier. For more information about Prettier and code formatting, see the [Best practices and code standards](./best-practices-code-standards.md) guidelines.

## `/pages`

The `/pages` directory contains all website pages that can be rendered by Next.js and viewed by users. Next.js looks for this root `/pages` directory automatically, a behaviour that cannot be changed. Next.js also automatically makes each page available at a route, with an identical name to the file. For example, the file `/pages/business-type.js` is available at the URL `/new/council-name/business-type`. For more information about the relationship between Next.js and Express and how URL routes are defined, see [The tech stack](./the-tech-stack.md).

## `/pages_unit_tests`

The `/pages_unit_tests` directory contains the unit tests for the `/pages` files. This is the only example where the unit tests are in a different directory to the corresponding files. Next.js uses all files in the `/pages` directory for the build process, something that cannot be changed, so the unit tests must be stored separately.

## `/src`

* `src/components`

  The `src/components` directory contains all of the supplementary visual components that are not directly part of a page. This approach can be used either for re-usability of visual elements or to reduce code clutter on longer pages. For example, the header, footer, summary table, and continue button are all individual components that can be re-used on multiple pages. For more information about `SessionWrapper.js` and the flow of data through the application, see [Data flow](./data-flow.md).

* `src/__mocks__`

  The `src/__mocks__` directory contains mock functions and dummy datasets that are used in a variety of test files throughout the repository.

* `src/server`

  The `src/server` directory contains all of the Express.js code to run the server-side parts of the application.

  The `./routes`, `./controllers`, `./services`, and `./connectors` directories contain URL routing configuration, business logic, data transformation functions, and external service connections. For more information about the relationships between routes, controllers, services, and connectors, see [Best practices and code standards](./best-practices-code-standards.md).

  * `index.js`

    Entry point for the `start` and `dev` scripts in `/package.json`. Starts the server listening on a specified or default port and references `server.js` for all further configuration.

  * `server.js`

    Root-level setup of Express.js routes and middleware. References `next.js` and the `./routes` directory. For more information about Express.js, see https://expressjs.com/.

  * `next.js`

    Setup of the Next.js framework `getRequestHandler()` and `render()` functions. If an environment variable of `NODE_ENV` is set to `production`, the request handler will look for a production build of any requested website pages in the root `/.next` directory. If `NODE_ENV` is set to anything else, the `getRequestHandler()` and `render()` functions will default to `dev` mode, which builds and hot-reloads pages on demand.

  * `config.js`

    Defines server-side configuration and provides default values for some environment variables.

## `/tests`

The `/tests` directory contains all non-unit tests. This currently includes contract and integration tests. For more information, see [Writing integration and contract tests](./writing-integration-contract-tests.md).

## `/docs`

* `docs/contribution-guidelines`

  Step-by-step guides and general information for contributing to this repository. For cross-repository guides and broader project information, see the [Confluence documentation](https://foodstandardsagency.atlassian.net/wiki/spaces/RFB).

* `docs/jsdoc` (not committed)

  Function-level documentation, generated by the `jsdoc` script in `package.json`. This content is also available in the code itself. Open `index.html` in a browser to view the JSDoc-generated website.

* `docs/LADR`

  LADRs (Lightweight Architecture Decision Records) are concise records of important technical decisions that have been made and the motives behind these decisions.

## Non-committed and other directories

The following directories are not committed to GitHub or are less important to the understanding of this repository.

* `/node_modules`

  This repository depends on third-party packages and libraries from [NPM](https://www.npmjs.com/). These packages are stored in the `/node_modules` directory.

* `/.next`

  Running `yarn build` outputs the built code to the `/.next` directory. The `yarn start` command requires this directory to be present.

* `/coverage`

  Jest outputs coverage information and reports to this directory. You can open `/coverage/lcov-report/index.html` in a browser to see visualised coverage data, which can be helpful for understanding why coverage is not 100%.

* `/reports`

  Jest outputs comprehensive test reports in XML format, which are used by Azure pipelines to display visualised test results.

* `/.vscode`

  The Visual Studio Code IDE uses `/.vscode/launch.json` to configure the debugger tool, which is useful as an alternative to `console.log()` for debugging.
